<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Risk-Aware Speculation Control</title>
  <meta name="description" content="Master's Thesis Proposal: A Risk-Aware Control Framework for Secure Microarchitecture." />

  <!-- Fonts: Inter & JetBrains Mono -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- KaTeX for Math -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <!-- Mermaid for Diagrams -->
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>

  <!-- Prism for Code Highlighting -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>

  <link rel="stylesheet" href="assets/styles.css" />
  <script defer src="assets/app.js"></script>
</head>

<body>
  <div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar__header">
        <div class="brand">ODU<span class="brand__dot">.</span>Frame</div>
        <div class="author">Mohammad Mahdi Razmjoo</div>
        <div class="date">Jan 2026 • M.Sc. Thesis</div>
      </div>
      
      <nav class="nav">
        <a class="nav__item" href="#abstract">01 // Abstract</a>
        <a class="nav__item" href="#logic">02 // Core Logic</a>
        <a class="nav__item" href="#architecture">03 // Architecture</a>
        <a class="nav__item" href="#setup">04 // Exp. Setup</a>
        <a class="nav__item" href="#validation">05 // Validation Code</a>
        <a class="nav__item" href="#plan">06 // Timeline</a>
      </nav>

      <div class="sidebar__footer">
        <a href="#" class="btn btn--ghost">Download PDF</a>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="content">
      <div class="container">
        
        <!-- Hero -->
        <section id="abstract" class="section hero">
          <h1 class="hero__title">A Risk-Aware Control Framework <br> <span class="text-gradient">for Secure Microarchitecture</span></h1>
          <p class="hero__lead">
            Moving from binary "Stop/Go" policies to a probabilistic <strong>Risk/Reward</strong> model. 
            We propose an <strong>Optimal Decision Unit (ODU)</strong> that permits speculation only when the expected utility is positive.
          </p>
          
          <div class="stats-grid">
            <div class="stat-card">
              <span class="stat-card__label">Target</span>
              <span class="stat-card__val">Spectre V1/V2</span>
            </div>
            <div class="stat-card">
              <span class="stat-card__label">Simulator</span>
              <span class="stat-card__val">gem5 (O3)</span>
            </div>
            <div class="stat-card">
              <span class="stat-card__label">Overhead Goal</span>
              <span class="stat-card__val">&lt; 10%</span>
            </div>
          </div>
        </section>

        <!-- Logic -->
        <section id="logic" class="section">
          <div class="section-header">
            <span class="section-num">02</span>
            <h2>The Utility Equation</h2>
          </div>
          
          <p>Current CPUs speculate blindly (High Risk). Static fences kill performance (Low Utility). We introduce a runtime check based on the <strong>Safety Inequality</strong>:</p>

          <div class="math-block">
            \[ \underbrace{\frac{\pi}{1 - \pi}}_{\text{Hardware Odds}} > \underbrace{\frac{\mathcal{L}}{\mathcal{G}}}_{\text{Software Cost}} \]
          </div>

          <div class="grid grid--2">
            <div class="card">
              <h3>Hardware Inputs (Dynamic)</h3>
              <ul class="var-list">
                <li><code class="var">π</code> : <strong>Confidence</strong> (from Branch Predictor).</li>
                <li><code class="var">G</code> : <strong>Gain</strong> (Cycles saved, e.g., Cache Hit/Miss status).</li>
              </ul>
            </div>
            <div class="card">
              <h3>Software Inputs (Static)</h3>
              <ul class="var-list">
                <li><code class="var">L</code> : <strong>Leakage Capacity</strong> (Bits/cycle via Compiler).</li>
                <li><code class="var">Threshold</code> : Tunable policy knob.</li>
              </ul>
            </div>
          </div>
        </section>

        <!-- Architecture -->
        <section id="architecture" class="section">
          <div class="section-header">
            <span class="section-num">03</span>
            <h2>Architecture (ODU)</h2>
          </div>
          <p>
            The <strong>Optimal Decision Unit</strong> sits in the Fetch stage. To avoid latency on the critical path, we avoid division by using Log-Domain Arithmetic and Lookup Tables (LUTs).
          </p>

          <div class="diagram-container">
            <pre class="mermaid">
flowchart LR
    BP[Branch Predictor] -->|Confidence π| ODU
    Cache[Cache Status] -->|Gain G| ODU
    Decode[Instruction Tags] -->|Leakage L| ODU
    
    subgraph ODU [Optimal Decision Unit]
      Logic{"Log(π) - Log(1-π) > Log(L) - Log(G)"}
    end

    ODU -->|Pass| Ex[Execute]
    ODU -->|Fail| Stall[Stall/Clamp]
            </pre>
          </div>
        </section>

        <!-- Setup -->
        <section id="setup" class="section">
          <div class="section-header">
            <span class="section-num">04</span>
            <h2>Experimental Setup</h2>
          </div>
          
          <p>
            We implement the ODU logic within the <strong>gem5 simulator (v23.0)</strong> using the <code>O3CPU</code> (Out-of-Order) model. 
            The environment is configured to replicate a modern Intel Skylake-like microarchitecture, capable of deep speculation required to reproduce Spectre V1/V2 vulnerabilities.
          </p>

          <div class="grid grid--2">
            <div class="card">
              <h3><span class="text-accent">01.</span> Microarchitecture Config</h3>
              <p class="text-sm">Parameters chosen to ensure side-channel visibility (cache timing) and speculation window depth.</p>
              <table class="data-table small-table">
                <tr>
                  <td><strong>Pipeline</strong></td>
                  <td>8-wide fetch/decode/commit</td>
                </tr>
                <tr>
                  <td><strong>ROB / LQ / SQ</strong></td>
                  <td>192 entries / 72 loads / 56 stores</td>
                </tr>
                <tr>
                  <td><strong>Branch Pred.</strong></td>
                  <td>Tournament Predictor (Local/Global history)</td>
                </tr>
                <tr>
                  <td><strong>L1 Cache</strong></td>
                  <td>32KB (8-way), 4-cycle latency <span class="tag tag--red">Attack Target</span></td>
                </tr>
                <tr>
                  <td><strong>L2 Cache</strong></td>
                  <td>256KB (4-way), 12-cycle latency</td>
                </tr>
                <tr>
                  <td><strong>Coherence</strong></td>
                  <td>MESI Protocol (Critical for Flush+Reload)</td>
                </tr>
              </table>
            </div>

            <div class="card">
              <h3><span class="text-accent">02.</span> Workload Selection</h3>
              <p class="text-sm">We segregate workloads to measure the two conflicting objectives of the thesis.</p>
              <ul class="var-list">
                <li>
                  <strong>Security: Litmus Tests</strong><br>
                  <span class="text-muted">Custom microbenchmarks derived from <em>Google Project Zero</em> and <em>Paul Kocher's</em> Spectre repository. These maximize leakage signal to stress-test the ODU's clamping logic.</span>
                </li>
                <li>
                  <strong>Performance: SPEC CPU2017</strong><br>
                  <span class="text-muted">Standard integer benchmarks (e.g., <code>gcc</code>, <code>mcf</code>) used to measure the IPC (Instructions Per Cycle) overhead of the ODU on benign code.</span>
                </li>
              </ul>
            </div>
          </div>

          <div class="callout" style="margin-top: 2rem;">
            <strong>Comparative Baselines:</strong>
            <ul class="comparison-list">
              <li><code class="tag tag--red">Baseline (Unsafe)</code>: Standard O3CPU with no mitigation. Serves as the upper bound for performance (1.0x speedup) and lower bound for security (Max Leakage).</li>
              <li><code class="tag tag--yellow">Static Fences</code>: <code>LFENCE</code> inserted by compiler before every load following a branch. Serves as the lower bound for performance (~0.6x speedup) and upper bound for security.</li>
              <li><code class="tag tag--green">ODU (Proposed)</code>: Dynamic clamping. Goal: Converge to Unsafe performance while maintaining Fence-level security on critical gadgets.</li>
            </ul>
          </div>
        </section>

        <!-- Validation Code -->
        <section id="validation" class="section">
          <div class="section-header">
            <span class="section-num">05</span>
            <h2>Validation Methodology</h2>
          </div>
          <p>
            Validation is performed via a <strong>Trace-Driven Analysis</strong>. We first confirm that the unmodified simulator leaks the secret key via Flush+Reload (High SNR). We then enable the ODU and measure the reduction in <strong>Transmission Rate (Bits/Sec)</strong> versus the <strong>IPC degradation</strong>.
          </p>

          <!-- Tabbed Code Interface -->
          <div class="code-tabs">
            <div class="tabs-header">
              <button class="tab-btn active" onclick="openTab(event, 'c1')">1. The Gadget (User Space)</button>
              <button class="tab-btn" onclick="openTab(event, 'c2')">2. The Attack (Measurement)</button>
              <button class="tab-btn" onclick="openTab(event, 'c3')">3. The Defense (gem5 Fetch)</button>
            </div>

            <!-- Tab 1: The Victim -->
            <div id="c1" class="tab-content active">
              <pre><code class="language-c">
/**
 * SPECTRE VARIANT 1 GADGET
 * Adapted from Kocher et al. (2019)
 * 
 * Scenario: Attacker mistrains branch predictor to assume (x < array1_size).
 * ODU Goal: Detect that 'array1[x]' is a dependent load with High Gain (Cache Miss)
 * and Low Confidence (Branch History), then clamp before 'array2' access.
 */

void victim_function(size_t x) {
    if (x < array1_size) {
        // <--- ODU DECISION POINT
        // Hardware Confidence (π) < 0.9 (Mistrained)
        // Leakage Potential (L) = High (Index used in subsequent load)
        
        // This line loads the secret into L1 Cache if speculated:
        temp &= array2[array1[x] * 512];
    }
}
              </code></pre>
            </div>

            <!-- Tab 2: The Attack -->
            <div id="c2" class="tab-content">
              <pre><code class="language-c">
/**
 * FLUSH + RELOAD MEASUREMENT
 * We measure the 'Transmission Rate' of the side channel.
 * A successful ODU defense results in a bitrate of 0 (Noise).
 */

void measure_leakage() {
    // 1. PRIME: Flush the probe array from cache hierarchy
    for (i = 0; i < 256; i++) {
        _mm_clflush(&array2[i * 512]);
    }

    // 2. TRIGGER: Call victim with malicious index
    // If ODU works, the speculative access to array2 is squashed early.
    victim_function(malicious_x);

    // 3. PROBE: Measure reload times
    for (i = 0; i < 256; i++) {
        uint64_t start = __rdtscp(&junk);
        junk = array2[i * 512]; 
        uint64_t delta = __rdtscp(&junk) - start;
        
        // If fast (< 80 cycles), it was cached -> LEAK
        if (delta <= CACHE_HIT_THRESHOLD) {
             results[i]++; 
        }
    }
}
              </code></pre>
            </div>

            <!-- Tab 3: The Defense -->
            <div id="c3" class="tab-content">
              <pre><code class="language-cpp">
/**
 * GEM5 FETCH UNIT MODIFICATION (Pseudo-C++)
 * Located in: src/cpu/o3/fetch.cc
 * 
 * We intercept the instruction fetch. If Risk > Utility, we issue
 * a 'pipeline bubble' (Stall) instead of the instruction.
 */

bool FetchUnit::checkRiskPolicy(DynInstPtr inst) {
    // 1. Extract Hardware State
    // We query the Tournament Predictor's local history table
    double pi = branchPred->getConfidence(inst->pc); 
    
    // 2. Extract Semantic Cost (Static Analysis Tag)
    // 0 = Benign (ADD), 1 = Transmitter (Dependent Load)
    double L = inst->staticInst->getLeakageClass(); 

    // 3. Calculate Gain Estimate
    // Check MSHR (Miss Status Holding Register) for L1 status
    double G = dcache->isLikelyHit(inst->addr) ? 1.0 : 100.0;

    // 4. Log-Domain Inequality Check (Avoids Division)
    // LUTs are precomputed at compile time
    double risk_val = LUT_Log[L] - LUT_Log[G];
    double odds_val = LUT_LogOdds[pi]; // log(pi / 1-pi)

    if (odds_val > risk_val) {
        return true; // Safe to Speculate
    } else {
        DPRINTF(ODU, "Clamping speculation at PC: %x\n", inst->pc);
        return false; // Insert Pipeline Stall
    }
}
              </code></pre>
            </div>
          </div>
        </section>

        <!-- Timeline -->
        <section id="plan" class="section">
          <div class="section-header">
            <span class="section-num">06</span>
            <h2>Timeline</h2>
          </div>
          <div class="timeline">
            <div class="timeline-item">
              <div class="t-date">Weeks 1-2</div>
              <div class="t-content">Base Setup: gem5 + SPEC2017 + Unsafe Baseline.</div>
            </div>
            <div class="timeline-item">
              <div class="t-date">Weeks 3-5</div>
              <div class="t-content"><strong>ODU Implementation:</strong> Inject C++ logic into Fetch Unit.</div>
            </div>
            <div class="timeline-item">
              <div class="t-date">Weeks 6-8</div>
              <div class="t-content"><strong>Security Eval:</strong> Run Spectre Gadgets (RQ1).</div>
            </div>
            <div class="timeline-item">
              <div class="t-date">Weeks 9-10</div>
              <div class="t-content"><strong>Perf Eval:</strong> Run SPEC2017 & Pareto Analysis (RQ2).</div>
            </div>
          </div>
        </section>

      </div>
    </main>
  </div>
</body>
</html>
